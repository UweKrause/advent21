<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2.py</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl lin">    1 </span><span class="hl kwa">import</span> math
<span class="hl lin">    2 </span>
<span class="hl lin">    3 </span><span class="hl kwa">import</span> numpy <span class="hl kwa">as</span> np
<span class="hl lin">    4 </span>
<span class="hl lin">    5 </span>FILE <span class="hl opt">=</span> <span class="hl sng">&quot;input&quot;</span>
<span class="hl lin">    6 </span>
<span class="hl lin">    7 </span>
<span class="hl lin">    8 </span><span class="hl kwa">def</span> <span class="hl kwd">main</span><span class="hl opt">():</span>
<span class="hl lin">    9 </span>    heightmap <span class="hl opt">=</span> <span class="hl kwd">parse_input</span><span class="hl opt">()</span>
<span class="hl lin">   10 </span>
<span class="hl lin">   11 </span>    points_low <span class="hl opt">=</span> <span class="hl kwd">get_points_low</span><span class="hl opt">(</span>heightmap<span class="hl opt">)</span>
<span class="hl lin">   12 </span>
<span class="hl lin">   13 </span>    basins <span class="hl opt">=</span> <span class="hl kwd">get_basins</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> points_low<span class="hl opt">)</span>
<span class="hl lin">   14 </span>
<span class="hl lin">   15 </span>    <span class="hl kwa">return</span> math<span class="hl opt">.</span><span class="hl kwd">prod</span><span class="hl opt">(</span><span class="hl kwd">get_largest_basins</span><span class="hl opt">(</span>basins<span class="hl opt">,</span> <span class="hl num">3</span><span class="hl opt">))</span>
<span class="hl lin">   16 </span>
<span class="hl lin">   17 </span>
<span class="hl lin">   18 </span><span class="hl kwa">def</span> <span class="hl kwd">get_largest_basins</span><span class="hl opt">(</span>basins<span class="hl opt">,</span> n<span class="hl opt">):</span>
<span class="hl lin">   19 </span>    basin_lengths <span class="hl opt">= [</span><span class="hl kwb">len</span><span class="hl opt">(</span>b<span class="hl opt">)</span> <span class="hl kwa">for</span> b <span class="hl kwa">in</span> basins<span class="hl opt">]</span>
<span class="hl lin">   20 </span>    basin_lengths<span class="hl opt">.</span><span class="hl kwd">sort</span><span class="hl opt">(</span>reverse<span class="hl opt">=</span><span class="hl kwa">True</span><span class="hl opt">)</span>
<span class="hl lin">   21 </span>    <span class="hl kwa">return</span> basin_lengths<span class="hl opt">[:</span>n<span class="hl opt">]</span>
<span class="hl lin">   22 </span>
<span class="hl lin">   23 </span>
<span class="hl lin">   24 </span><span class="hl kwa">def</span> <span class="hl kwd">parse_input</span><span class="hl opt">():</span>
<span class="hl lin">   25 </span>    with <span class="hl kwb">open</span><span class="hl opt">(</span>FILE<span class="hl opt">)</span> <span class="hl kwa">as</span> lines<span class="hl opt">:</span>
<span class="hl lin">   26 </span>        rows <span class="hl opt">=</span> <span class="hl num">0</span>
<span class="hl lin">   27 </span>        fields <span class="hl opt">= []</span>
<span class="hl lin">   28 </span>        <span class="hl kwa">for</span> line <span class="hl kwa">in</span> lines<span class="hl opt">:</span>
<span class="hl lin">   29 </span>            rows <span class="hl opt">+=</span> <span class="hl num">1</span>
<span class="hl lin">   30 </span>            fields <span class="hl opt">+=</span> line<span class="hl opt">.</span><span class="hl kwd">strip</span><span class="hl opt">()</span>
<span class="hl lin">   31 </span>
<span class="hl lin">   32 </span>        columns <span class="hl opt">=</span> <span class="hl kwb">len</span><span class="hl opt">(</span>line<span class="hl opt">.</span><span class="hl kwd">strip</span><span class="hl opt">())</span>
<span class="hl lin">   33 </span>
<span class="hl lin">   34 </span>        heightmap <span class="hl opt">=</span> np<span class="hl opt">.</span><span class="hl kwd">array</span><span class="hl opt">(</span>fields<span class="hl opt">,</span> dtype<span class="hl opt">=</span><span class="hl kwb">int</span><span class="hl opt">)</span>
<span class="hl lin">   35 </span>        heightmap <span class="hl opt">=</span> heightmap<span class="hl opt">.</span><span class="hl kwd">reshape</span><span class="hl opt">((</span>rows<span class="hl opt">,</span> columns<span class="hl opt">))</span>
<span class="hl lin">   36 </span>
<span class="hl lin">   37 </span>        <span class="hl kwa">return</span> heightmap
<span class="hl lin">   38 </span>
<span class="hl lin">   39 </span>
<span class="hl lin">   40 </span><span class="hl kwa">def</span> <span class="hl kwd">get_points_low</span><span class="hl opt">(</span>heightmap<span class="hl opt">):</span>
<span class="hl lin">   41 </span>    rows<span class="hl opt">,</span> columns <span class="hl opt">=</span> heightmap<span class="hl opt">.</span>shape
<span class="hl lin">   42 </span>
<span class="hl lin">   43 </span>    points_low <span class="hl opt">=</span> np<span class="hl opt">.</span><span class="hl kwd">zeros</span><span class="hl opt">(</span>shape<span class="hl opt">=(</span>rows<span class="hl opt">,</span> columns<span class="hl opt">),</span> dtype<span class="hl opt">=</span><span class="hl kwb">int</span><span class="hl opt">)</span>
<span class="hl lin">   44 </span>    <span class="hl kwa">for</span> r <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span>rows<span class="hl opt">):</span>
<span class="hl lin">   45 </span>        <span class="hl kwa">for</span> c <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span>columns<span class="hl opt">):</span>
<span class="hl lin">   46 </span>            point <span class="hl opt">= (</span>r<span class="hl opt">,</span> c<span class="hl opt">)</span>
<span class="hl lin">   47 </span>            h_point <span class="hl opt">=</span> heightmap<span class="hl opt">[</span>point<span class="hl opt">]</span>
<span class="hl lin">   48 </span>            h_up<span class="hl opt">,</span> h_right<span class="hl opt">,</span> h_down<span class="hl opt">,</span> h_left <span class="hl opt">=</span> <span class="hl kwd">get_neighbours_height</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> point<span class="hl opt">)</span>
<span class="hl lin">   49 </span>
<span class="hl lin">   50 </span>            <span class="hl kwa">if</span> <span class="hl kwd">is_point_low</span><span class="hl opt">(</span>h_point<span class="hl opt">,</span> h_up<span class="hl opt">,</span> h_right<span class="hl opt">,</span> h_down<span class="hl opt">,</span> h_left<span class="hl opt">):</span>
<span class="hl lin">   51 </span>                points_low<span class="hl opt">[</span>point<span class="hl opt">] =</span> <span class="hl num">1</span>
<span class="hl lin">   52 </span>
<span class="hl lin">   53 </span>    <span class="hl kwa">return</span> points_low
<span class="hl lin">   54 </span>
<span class="hl lin">   55 </span>
<span class="hl lin">   56 </span><span class="hl kwa">def</span> <span class="hl kwd">is_point_low</span><span class="hl opt">(</span>height<span class="hl opt">,</span> height_down<span class="hl opt">,</span> height_left<span class="hl opt">,</span> height_right<span class="hl opt">,</span> height_up<span class="hl opt">):</span>
<span class="hl lin">   57 </span>    <span class="hl kwa">return</span> height <span class="hl opt">&lt;</span> height_up \
<span class="hl lin">   58 </span>           <span class="hl kwa">and</span> height <span class="hl opt">&lt;</span> height_right \
<span class="hl lin">   59 </span>           <span class="hl kwa">and</span> height <span class="hl opt">&lt;</span> height_down \
<span class="hl lin">   60 </span>           <span class="hl kwa">and</span> height <span class="hl opt">&lt;</span> height_left
<span class="hl lin">   61 </span>
<span class="hl lin">   62 </span>
<span class="hl lin">   63 </span><span class="hl kwa">def</span> <span class="hl kwd">get_basins</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> points_low<span class="hl opt">):</span>
<span class="hl lin">   64 </span>    basins <span class="hl opt">= []</span>
<span class="hl lin">   65 </span>    <span class="hl kwa">for</span> x<span class="hl opt">,</span> y <span class="hl kwa">in</span> np<span class="hl opt">.</span><span class="hl kwd">argwhere</span><span class="hl opt">(</span>points_low<span class="hl opt">):</span>
<span class="hl lin">   66 </span>        basin <span class="hl opt">=</span> <span class="hl kwb">set</span><span class="hl opt">()</span>
<span class="hl lin">   67 </span>        to_check <span class="hl opt">=</span> <span class="hl kwb">set</span><span class="hl opt">()</span>
<span class="hl lin">   68 </span>        to_check<span class="hl opt">.</span><span class="hl kwd">add</span><span class="hl opt">((</span>x<span class="hl opt">,</span> y<span class="hl opt">))</span>
<span class="hl lin">   69 </span>
<span class="hl lin">   70 </span>        <span class="hl slc"># todo: find better way</span>
<span class="hl lin">   71 </span>        <span class="hl kwa">while</span> to_check <span class="hl opt">!=</span> basin<span class="hl opt">:</span>
<span class="hl lin">   72 </span>            <span class="hl kwa">for</span> c <span class="hl kwa">in</span> to_check<span class="hl opt">.</span><span class="hl kwd">copy</span><span class="hl opt">():</span>
<span class="hl lin">   73 </span>                <span class="hl kwa">if</span> c <span class="hl kwa">is not None and</span> heightmap<span class="hl opt">[</span>c<span class="hl opt">] &lt;</span> <span class="hl num">9</span><span class="hl opt">:</span>
<span class="hl lin">   74 </span>                    basin<span class="hl opt">.</span><span class="hl kwd">add</span><span class="hl opt">(</span>c<span class="hl opt">)</span>
<span class="hl lin">   75 </span>
<span class="hl lin">   76 </span>                    <span class="hl slc"># todo: remove duplicate check</span>
<span class="hl lin">   77 </span>                    <span class="hl kwa">for</span> n <span class="hl kwa">in</span> <span class="hl kwd">get_neighbours</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> c<span class="hl opt">):</span>
<span class="hl lin">   78 </span>                        <span class="hl kwa">if</span> n <span class="hl kwa">is not None and</span> heightmap<span class="hl opt">[</span>n<span class="hl opt">] &lt;</span> <span class="hl num">9</span><span class="hl opt">:</span>
<span class="hl lin">   79 </span>                            to_check<span class="hl opt">.</span><span class="hl kwd">add</span><span class="hl opt">(</span>n<span class="hl opt">)</span>
<span class="hl lin">   80 </span>
<span class="hl lin">   81 </span>        basins<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">(</span>basin<span class="hl opt">)</span>
<span class="hl lin">   82 </span>
<span class="hl lin">   83 </span>    <span class="hl kwa">return</span> basins
<span class="hl lin">   84 </span>
<span class="hl lin">   85 </span>
<span class="hl lin">   86 </span><span class="hl kwa">def</span> <span class="hl kwd">get_neighbours</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> point<span class="hl opt">):</span>
<span class="hl lin">   87 </span>    rows<span class="hl opt">,</span> columns <span class="hl opt">=</span> heightmap<span class="hl opt">.</span>shape
<span class="hl lin">   88 </span>    x<span class="hl opt">,</span> y <span class="hl opt">=</span> point
<span class="hl lin">   89 </span>
<span class="hl lin">   90 </span>    n_up <span class="hl opt">= (</span>x <span class="hl opt">-</span> <span class="hl num">1</span><span class="hl opt">,</span> y<span class="hl opt">)</span> <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl num">0</span> <span class="hl opt">&lt;</span> x<span class="hl opt">)</span> <span class="hl kwa">else None</span>
<span class="hl lin">   91 </span>    n_right <span class="hl opt">= (</span>x<span class="hl opt">,</span> y <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">)</span> <span class="hl kwa">if</span> <span class="hl opt">(</span>y <span class="hl opt">&lt;</span> columns <span class="hl opt">-</span> <span class="hl num">1</span><span class="hl opt">)</span> <span class="hl kwa">else None</span>
<span class="hl lin">   92 </span>    n_down <span class="hl opt">= (</span>x <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">,</span> y<span class="hl opt">)</span> <span class="hl kwa">if</span> <span class="hl opt">(</span>x <span class="hl opt">&lt;</span> rows <span class="hl opt">-</span> <span class="hl num">1</span><span class="hl opt">)</span> <span class="hl kwa">else None</span>
<span class="hl lin">   93 </span>    n_left <span class="hl opt">= (</span>x<span class="hl opt">,</span> y <span class="hl opt">-</span> <span class="hl num">1</span><span class="hl opt">)</span> <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl num">0</span> <span class="hl opt">&lt;</span> y<span class="hl opt">)</span> <span class="hl kwa">else None</span>
<span class="hl lin">   94 </span>
<span class="hl lin">   95 </span>    <span class="hl kwa">return</span> n_up<span class="hl opt">,</span> n_right<span class="hl opt">,</span> n_down<span class="hl opt">,</span> n_left
<span class="hl lin">   96 </span>
<span class="hl lin">   97 </span>
<span class="hl lin">   98 </span><span class="hl kwa">def</span> <span class="hl kwd">get_neighbours_height</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> point<span class="hl opt">):</span>
<span class="hl lin">   99 </span>    n_up<span class="hl opt">,</span> n_right<span class="hl opt">,</span> n_down<span class="hl opt">,</span> n_left <span class="hl opt">=</span> <span class="hl kwd">get_neighbours</span><span class="hl opt">(</span>heightmap<span class="hl opt">,</span> point<span class="hl opt">)</span>
<span class="hl lin">  100 </span>
<span class="hl lin">  101 </span>    h_up <span class="hl opt">=</span> heightmap<span class="hl opt">[</span>n_up<span class="hl opt">]</span> <span class="hl kwa">if</span> n_up <span class="hl kwa">is not None else</span> math<span class="hl opt">.</span>inf
<span class="hl lin">  102 </span>    h_right <span class="hl opt">=</span> heightmap<span class="hl opt">[</span>n_right<span class="hl opt">]</span> <span class="hl kwa">if</span> n_right <span class="hl kwa">is not None else</span> math<span class="hl opt">.</span>inf
<span class="hl lin">  103 </span>    h_down <span class="hl opt">=</span> heightmap<span class="hl opt">[</span>n_down<span class="hl opt">]</span> <span class="hl kwa">if</span> n_down <span class="hl kwa">is not None else</span> math<span class="hl opt">.</span>inf
<span class="hl lin">  104 </span>    h_left <span class="hl opt">=</span> heightmap<span class="hl opt">[</span>n_left<span class="hl opt">]</span> <span class="hl kwa">if</span> n_left <span class="hl kwa">is not None else</span> math<span class="hl opt">.</span>inf
<span class="hl lin">  105 </span>
<span class="hl lin">  106 </span>    <span class="hl kwa">return</span> h_up<span class="hl opt">,</span> h_right<span class="hl opt">,</span> h_down<span class="hl opt">,</span> h_left
<span class="hl lin">  107 </span>
<span class="hl lin">  108 </span>
<span class="hl lin">  109 </span><span class="hl kwa">if</span> __name__ <span class="hl opt">==</span> <span class="hl sng">&#39;__main__&#39;</span><span class="hl opt">:</span>
<span class="hl lin">  110 </span>    <span class="hl kwa">print</span><span class="hl opt">(</span><span class="hl kwd">main</span><span class="hl opt">())</span>  <span class="hl slc"># 900900</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 4.1, http://www.andre-simon.de/-->
