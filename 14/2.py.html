<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2.py</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl lin">    1 </span><span class="hl kwa">from</span> collections <span class="hl kwa">import</span> defaultdict
<span class="hl lin">    2 </span>
<span class="hl lin">    3 </span>FILE <span class="hl opt">=</span> <span class="hl sng">&quot;input&quot;</span>
<span class="hl lin">    4 </span>
<span class="hl lin">    5 </span>STEPS <span class="hl opt">=</span> <span class="hl num">40</span>
<span class="hl lin">    6 </span>
<span class="hl lin">    7 </span><span class="hl sng">&quot;&quot;&quot;</span>
<span class="hl lin">    8 </span><span class="hl sng">Code for Part 2 is exactly the same as for 1.</span>
<span class="hl lin">    9 </span><span class="hl sng">&quot;&quot;&quot;</span>
<span class="hl lin">   10 </span>
<span class="hl lin">   11 </span>
<span class="hl lin">   12 </span><span class="hl kwa">def</span> <span class="hl kwd">main</span><span class="hl opt">():</span>
<span class="hl lin">   13 </span>    template<span class="hl opt">,</span> rules <span class="hl opt">=</span> <span class="hl kwd">parse_input</span><span class="hl opt">()</span>
<span class="hl lin">   14 </span>
<span class="hl lin">   15 </span>    pairs<span class="hl opt">,</span> letters <span class="hl opt">=</span> <span class="hl kwd">extract_pairs_and_letters</span><span class="hl opt">(</span>template<span class="hl opt">)</span>
<span class="hl lin">   16 </span>
<span class="hl lin">   17 </span>    _<span class="hl opt">,</span> letters <span class="hl opt">=</span> <span class="hl kwd">get_segments</span><span class="hl opt">(</span>pairs<span class="hl opt">,</span> letters<span class="hl opt">,</span> rules<span class="hl opt">)</span>
<span class="hl lin">   18 </span>
<span class="hl lin">   19 </span>    <span class="hl kwa">return</span> <span class="hl kwb">max</span><span class="hl opt">(</span>letters<span class="hl opt">.</span><span class="hl kwd">values</span><span class="hl opt">()) -</span> <span class="hl kwb">min</span><span class="hl opt">(</span>letters<span class="hl opt">.</span><span class="hl kwd">values</span><span class="hl opt">())</span>
<span class="hl lin">   20 </span>
<span class="hl lin">   21 </span>
<span class="hl lin">   22 </span><span class="hl kwa">def</span> <span class="hl kwd">extract_pairs_and_letters</span><span class="hl opt">(</span>template<span class="hl opt">):</span>
<span class="hl lin">   23 </span>    pairs <span class="hl opt">=</span> <span class="hl kwd">defaultdict</span><span class="hl opt">(</span><span class="hl kwb">int</span><span class="hl opt">)</span>
<span class="hl lin">   24 </span>    letters <span class="hl opt">=</span> <span class="hl kwd">defaultdict</span><span class="hl opt">(</span><span class="hl kwb">int</span><span class="hl opt">)</span>
<span class="hl lin">   25 </span>    <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl kwb">len</span><span class="hl opt">(</span>template<span class="hl opt">) -</span> <span class="hl num">1</span><span class="hl opt">):</span>
<span class="hl lin">   26 </span>        pairs<span class="hl opt">[</span>template<span class="hl opt">[</span>i<span class="hl opt">] +</span> template<span class="hl opt">[</span>i <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">]] +=</span> <span class="hl num">1</span>
<span class="hl lin">   27 </span>        letters<span class="hl opt">[</span>template<span class="hl opt">[</span>i<span class="hl opt">]] +=</span> <span class="hl num">1</span>
<span class="hl lin">   28 </span>    <span class="hl slc"># don&#39;t forget the last letter</span>
<span class="hl lin">   29 </span>    letters<span class="hl opt">[</span>template<span class="hl opt">[-</span><span class="hl num">1</span><span class="hl opt">]] +=</span> <span class="hl num">1</span>
<span class="hl lin">   30 </span>    <span class="hl kwa">return</span> pairs<span class="hl opt">,</span> letters
<span class="hl lin">   31 </span>
<span class="hl lin">   32 </span>
<span class="hl lin">   33 </span><span class="hl kwa">def</span> <span class="hl kwd">get_segments</span><span class="hl opt">(</span>pairs<span class="hl opt">,</span> letters<span class="hl opt">,</span> rules<span class="hl opt">):</span>
<span class="hl lin">   34 </span>    <span class="hl kwa">for</span> step <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span> STEPS <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">):</span>
<span class="hl lin">   35 </span>
<span class="hl lin">   36 </span>        pairs_before <span class="hl opt">=</span> <span class="hl kwd">defaultdict</span><span class="hl opt">(</span><span class="hl kwb">int</span><span class="hl opt">,</span> pairs<span class="hl opt">.</span><span class="hl kwd">copy</span><span class="hl opt">())</span>
<span class="hl lin">   37 </span>        pairs_after <span class="hl opt">=</span> <span class="hl kwd">defaultdict</span><span class="hl opt">(</span><span class="hl kwb">int</span><span class="hl opt">,</span> pairs<span class="hl opt">.</span><span class="hl kwd">copy</span><span class="hl opt">())</span>
<span class="hl lin">   38 </span>
<span class="hl lin">   39 </span>        <span class="hl kwa">for</span> pair<span class="hl opt">,</span> pair_count <span class="hl kwa">in</span> pairs_before<span class="hl opt">.</span><span class="hl kwd">items</span><span class="hl opt">():</span>
<span class="hl lin">   40 </span>
<span class="hl lin">   41 </span>            <span class="hl kwa">for</span> rule_replace<span class="hl opt">,</span> rule_replacement <span class="hl kwa">in</span> rules<span class="hl opt">.</span><span class="hl kwd">items</span><span class="hl opt">():</span>
<span class="hl lin">   42 </span>
<span class="hl lin">   43 </span>                <span class="hl kwa">if</span> pair <span class="hl opt">!=</span> rule_replace<span class="hl opt">:</span>
<span class="hl lin">   44 </span>                    <span class="hl kwa">continue</span>
<span class="hl lin">   45 </span>
<span class="hl lin">   46 </span>                replacement1 <span class="hl opt">=</span> pair<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">] +</span> rule_replacement
<span class="hl lin">   47 </span>                replacement2 <span class="hl opt">=</span> rule_replacement <span class="hl opt">+</span> pair<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]</span>
<span class="hl lin">   48 </span>
<span class="hl lin">   49 </span>                <span class="hl slc"># change pairs</span>
<span class="hl lin">   50 </span>                pairs_after<span class="hl opt">[</span>pair<span class="hl opt">] -=</span> pair_count
<span class="hl lin">   51 </span>                pairs_after<span class="hl opt">[</span>replacement1<span class="hl opt">] +=</span> pair_count
<span class="hl lin">   52 </span>                pairs_after<span class="hl opt">[</span>replacement2<span class="hl opt">] +=</span> pair_count
<span class="hl lin">   53 </span>
<span class="hl lin">   54 </span>                <span class="hl slc"># append letter</span>
<span class="hl lin">   55 </span>                letters<span class="hl opt">[</span>rule_replacement<span class="hl opt">] +=</span> pair_count
<span class="hl lin">   56 </span>
<span class="hl lin">   57 </span>        <span class="hl slc"># get rid of pairs with zero or negative occurrence</span>
<span class="hl lin">   58 </span>        pairs <span class="hl opt">= {</span>x<span class="hl opt">:</span> y <span class="hl kwa">for</span> x<span class="hl opt">,</span> y <span class="hl kwa">in</span> pairs_after<span class="hl opt">.</span><span class="hl kwd">items</span><span class="hl opt">()</span> <span class="hl kwa">if</span> y <span class="hl opt">&gt;</span> <span class="hl num">0</span><span class="hl opt">}</span>
<span class="hl lin">   59 </span>
<span class="hl lin">   60 </span>        <span class="hl kwa">if</span> FILE <span class="hl opt">==</span> <span class="hl sng">&quot;example&quot;</span><span class="hl opt">:</span>
<span class="hl lin">   61 </span>            <span class="hl kwd">check_example</span><span class="hl opt">(</span>pairs<span class="hl opt">,</span> letters<span class="hl opt">,</span> step<span class="hl opt">)</span>
<span class="hl lin">   62 </span>
<span class="hl lin">   63 </span>    <span class="hl kwa">return</span> pairs<span class="hl opt">,</span> letters
<span class="hl lin">   64 </span>
<span class="hl lin">   65 </span>
<span class="hl lin">   66 </span><span class="hl kwa">def</span> <span class="hl kwd">check_example</span><span class="hl opt">(</span>pairs<span class="hl opt">,</span> letters<span class="hl opt">,</span> step<span class="hl opt">):</span>
<span class="hl lin">   67 </span>    check <span class="hl opt">= {</span>
<span class="hl lin">   68 </span>        <span class="hl num">0</span><span class="hl opt">:</span> <span class="hl sng">&quot;NNCB&quot;</span><span class="hl opt">,</span>
<span class="hl lin">   69 </span>        <span class="hl num">1</span><span class="hl opt">:</span> <span class="hl sng">&quot;NCNBCHB&quot;</span><span class="hl opt">,</span>
<span class="hl lin">   70 </span>        <span class="hl num">2</span><span class="hl opt">:</span> <span class="hl sng">&quot;NBCCNBBBCBHCB&quot;</span><span class="hl opt">,</span>
<span class="hl lin">   71 </span>        <span class="hl num">3</span><span class="hl opt">:</span> <span class="hl sng">&quot;NBBBCNCCNBBNBNBBCHBHHBCHB&quot;</span><span class="hl opt">,</span>
<span class="hl lin">   72 </span>        <span class="hl num">4</span><span class="hl opt">:</span> <span class="hl sng">&quot;NBBNBNBBCCNBCNCCNBBNBBNBBBNBBNBBCBHCBHHNHCBBCBHCB&quot;</span><span class="hl opt">,</span>
<span class="hl lin">   73 </span>    <span class="hl opt">}</span>
<span class="hl lin">   74 </span>
<span class="hl lin">   75 </span>    <span class="hl kwa">if</span> step <span class="hl kwa">in</span> check<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">():</span>
<span class="hl lin">   76 </span>        pairs1<span class="hl opt">,</span> letters1 <span class="hl opt">=</span> <span class="hl kwd">extract_pairs_and_letters</span><span class="hl opt">(</span>check<span class="hl opt">[</span>step<span class="hl opt">])</span>
<span class="hl lin">   77 </span>        <span class="hl kwa">assert</span> pairs <span class="hl opt">==</span> pairs1
<span class="hl lin">   78 </span>        <span class="hl kwa">assert</span> letters <span class="hl opt">==</span> letters1
<span class="hl lin">   79 </span>
<span class="hl lin">   80 </span>
<span class="hl lin">   81 </span><span class="hl kwa">def</span> <span class="hl kwd">parse_input</span><span class="hl opt">():</span>
<span class="hl lin">   82 </span>    <span class="hl sng">&quot;&quot;&quot;parse input to numbers drawn and boards available&quot;&quot;&quot;</span>
<span class="hl lin">   83 </span>
<span class="hl lin">   84 </span>    with <span class="hl kwb">open</span><span class="hl opt">(</span>FILE<span class="hl opt">)</span> <span class="hl kwa">as</span> lines<span class="hl opt">:</span>
<span class="hl lin">   85 </span>        <span class="hl slc"># first line contains the template</span>
<span class="hl lin">   86 </span>        template <span class="hl opt">=</span> lines<span class="hl opt">.</span><span class="hl kwd">readline</span><span class="hl opt">().</span><span class="hl kwd">strip</span><span class="hl opt">()</span>
<span class="hl lin">   87 </span>
<span class="hl lin">   88 </span>        <span class="hl slc"># second line is empty</span>
<span class="hl lin">   89 </span>        _ <span class="hl opt">=</span> lines<span class="hl opt">.</span><span class="hl kwd">readline</span><span class="hl opt">()</span>
<span class="hl lin">   90 </span>
<span class="hl lin">   91 </span>        <span class="hl slc"># extract all the rules from remaining input</span>
<span class="hl lin">   92 </span>        rules <span class="hl opt">= {}</span>
<span class="hl lin">   93 </span>        <span class="hl kwa">for</span> line <span class="hl kwa">in</span> lines<span class="hl opt">.</span><span class="hl kwd">readlines</span><span class="hl opt">():</span>
<span class="hl lin">   94 </span>            rule_insert_where<span class="hl opt">,</span> rule_insert_what <span class="hl opt">=</span> line<span class="hl opt">.</span><span class="hl kwd">strip</span><span class="hl opt">().</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl sng">&quot; -&gt; &quot;</span><span class="hl opt">)</span>
<span class="hl lin">   95 </span>
<span class="hl lin">   96 </span>            <span class="hl kwa">if</span> <span class="hl kwb">len</span><span class="hl opt">(</span>rule_insert_where<span class="hl opt">) !=</span> <span class="hl num">2</span> <span class="hl kwa">or</span> <span class="hl kwb">len</span><span class="hl opt">(</span>rule_insert_what<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">:</span>
<span class="hl lin">   97 </span>                <span class="hl kwa">raise</span> <span class="hl kwc">NotImplementedError</span>
<span class="hl lin">   98 </span>
<span class="hl lin">   99 </span>            rules<span class="hl opt">[</span>rule_insert_where<span class="hl opt">] =</span> rule_insert_what
<span class="hl lin">  100 </span>
<span class="hl lin">  101 </span>    <span class="hl kwa">return</span> template<span class="hl opt">,</span> rules
<span class="hl lin">  102 </span>
<span class="hl lin">  103 </span>
<span class="hl lin">  104 </span><span class="hl kwa">if</span> __name__ <span class="hl opt">==</span> <span class="hl sng">&#39;__main__&#39;</span><span class="hl opt">:</span>
<span class="hl lin">  105 </span>    <span class="hl kwa">print</span><span class="hl opt">(</span><span class="hl kwd">main</span><span class="hl opt">())</span>  <span class="hl slc"># 3447389044530</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 4.1, http://www.andre-simon.de/-->
